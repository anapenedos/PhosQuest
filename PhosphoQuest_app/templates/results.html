<!--Due to problems rendering the layout template with the jquery the styles were added again on this template-->
<!--To be fixed for production-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <!-- jQuery implementation -->
    <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/smoothness/jquery-ui.css">
    <script src="//code.jquery.com/jquery-1.12.4.js"></script>
    <script src="//code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

    <!-- Bootstrap Required meta tags -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
          integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <!-- our main custom css in static-->
    <link rel="stylesheet" type="text/css" href="{{url_for('static', filename='styles/main.css')}}">

    <!--Set title if entered in to render function or add default-->
    {% if title %}
       <title>PhosphoQuest -{{ title }}</title>
    {% else %}
        <title>PhosphoQuest toolkit</title>
    {% endif %}

    <!-- Bootstrap -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

</head>
<body>
<!--add header bar with bootstrap classes-->
    <header class="site-header">
      <nav class="navbar navbar-expand-md navbar-dark bg-blue fixed-top">
        <div class="container">
          <a class="navbar-brand mr-4" href="/">PhosphoQuest</a>
          <button class="navbar-toggler" type="button" data-toggle="collapse"
                  data-target="#navbarToggle" aria-controls="navbarToggle"
                  aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
          </button>
          <div class="collapse navbar-collapse" id="navbarToggle">
            <div class="navbar-nav mr-auto">
              <a class="nav-item nav-link" href="{{ url_for('main.home') }}">Home</a>
              <a class="nav-item nav-link" href= "{{ url_for('search.search_db') }}" >Search</a>
              <a class="nav-item nav-link" href= "{{ url_for('browse.browse_main') }}">Browse</a>
              <a class="nav-item nav-link" href="{{ url_for('crunch.analysis') }}">User Data Analysis</a>
              <a class="nav-item nav-link" href="{{ url_for('main.documentation') }}">Documentation</a>
              <a class="nav-item nav-link" href="{{ url_for('main.about') }}">About Us</a>
            </div>
          </div>
        </div>
      </nav>
    </header>


    <!-- flash messages bootstrap styles-->
    <main role="main" div class="container">
      <div class="row">
        <div class="col-md-12">
             <!-- print error messages from form validation-->
            {% with messages = get_flashed_messages(with_categories=true) %}
               {% if messages %}
                  {% for category, message in messages %}
                     <div class = "alert alert-{{ category }}">
                         {{ message }}
                     </div>
                   {% endfor %}
               {% endif %}
            {% endwith %}
        </div>
      </div>
    </main>
    <div class = 'container'>
    <H2><center><b><em>Phospho-proteomics Data Analysis Results</center></b></em></H2>
    <br>
    <div id="tabs">
      <ul>
        <li><a href="#analysis-1"><span>Processed Table</span></a></li>
        <li><a href="#analysis-2"><span>Volcano Plot</span></a></li>
        <li><a href="#analysis-3"><span>Kinase & Substrate Frequencies</span></a></li>
        <li><a href="#analysis-4"><span>Summary Charts</span></a></li>
        <li><a href="#analysis-5"><span>Download data</span></a></li>
      </ul>
      <div id="analysis-1">
        </p>
        <b>General overview: </b> This table corresponds to hits, whose corrected
        p-values meet an error rate threshold of <=0.05 and have a CV of <=25%. 
        If the original upload table didn't include CV columns, then only the 
        p-value threshold is applied.
        </p>
        <b>Clickable entries: </b> Try clicking entries in columns: 
        <em>Substrate/Isoform in DB (gene name)</em>, <em>Phosphosite in DB (ID)</em> and
        <em>Kinase in DB (gene name)</em>. We guarantee a pleasant journey!
        </p>
        <em><u>TIP</u></em>: right click on entries and open link in a new tab,
        otherwise analysis will need to be re-started.
        </p>  
        <b>Intensity columns: </b> Original intensity values were transformed 
        by dividing each substrate/site intensity by the maximum intensity
        of the row (both conditions). This scaling allows the application of 
        a heatmap to the cells, for visual clarification of intensity differences.
        </p> 
        <b>Log2 fold changes: </b> Barplots are integrated into the column, that scale
        with the fold change values. <em>Note</em>: Cells that are fully coloured
        denote hits detected in only one condition (see intensity columns). 
        </p> 
        <b>Sorting: </b> The Log2 fold changes are used, giving a gradated
        ordering of hits as you scroll through the table.
        </p>  
        <div class=table.dataframe>
            {{ plots['table']|safe }}
        </div>
      </div>
        <div id="analysis-2">
        </p>
        <b>General overview: </b> Scatter of Log2 fold changes vs -log10(corrected p-values).
        </p>
        <b>Interactivity: </b> Hovering cursor over individual points will
        display substrate/site and exact X/Y-axis values. Please also note the extra
        extra interaction options on the top right hand corner of the plot.  
        </p>
        <b>Thresholds (dashed lines): </b> 
        </p>
        <em><u>Vertical line</u></em>: denotes a +/- Log2 fold change of 1 (actual fold change = 2).
        </p>
        <em><u>Horizontal line</u></em>: denotes a -log10(correctedp-value) of 1.3 (actual value = 0.05).
        </p>
          <hr>
            {{ plots['volcano'] |safe}}
        </div>
      <div id="analysis-3">
          <p>
            <b>General overview: </b> These visualisations correspond to analysis
            of the full list of phosphorylated-sites in your data. By drawing  
            on information in <em>PhosphoQuest's</em> database, we can generate 
            WordClouds paired with frequency charts. We hope this will help you 
            gauge how some hits are strongly emphasised in the WordClouds.
            </p>
          <hr>
          <div class = "row">
              <div class="col-md-6">
                  <center><H6><b>Most active Kinases - Top 30</b></H6>
                      <img src={{url_for('static', filename='userdata_temp/'+ plots["kin_wcloud"])}}> </center>
              </div>
              <div class="col-md-6">
                  <center><H6><b>Most targetted Substrate/Sites - Top 30</b></H6>
                      <img src={{url_for('static', filename='userdata_temp/'+ plots["subs_sites_wcloud"])}}>
                  </center>
              </div>
          </div>
          <br>
          <div class = "row">
              <div class="col-md-6">
                  <center><H6><b>Frequency Chart</b></H6>
                      <img src={{url_for('static', filename='userdata_temp/'+ plots["kin_freq"])}} width="500"> </center>
              </div>
              <div class="col-md-6">
                  <center><H6><b>Frequency Chart</b></H6>
                      <img src={{url_for('static', filename='userdata_temp/'+ plots["kin_target_freq"])}} width="500"> </center>
              </div>
          </div>
          <br>
          <div class = "col-md-2">
          </div>
          <div class = "col-md-8">
              <center><H6><b>Kinases Relative Activity</b></H6></center>
                  <center>{{ plots['kin_act'] | safe}} </center>
          </div>
      </div>
      <div id="analysis-4">
          <div class = "row">
              <div class="col-md-6">
                  <center><H5>Phosphosite Enrichment </H5>
                      {{ plots["phos_enrich_pie"] | safe}} </center>
              </div>
              <div class="col-md-6">
                  <center><H5>multi phospho residue frequency</H5>
                      {{ plots["multi_phos_res_freq_pie"] | safe }}</center>
              </div>
          </div>
          <div class = "row">
              <div class="col-md-6">
                  <center><H5>Amino Acid modified residue frequency</H5>
                      {{ plots["AA_mod_res_freq_pie"] |safe }}</center>
              </div>
          </div>
      </div>
      <div id="analysis-5">
          <H4>Download your analysed data:</H4>
          <p>CSV file containing all of your datapoints with analysis
            <p class="lead">
                <a class="btn btn-warning btn-sml"
                  href="{{url_for('crunch.download_analysis',
                             csv=csv)}}" role="button"> {{ csv }}</a>
            </p>
      </div>
    </div>
    <script>
    $( "#tabs" ).tabs();
    </script>
    </div>
</body>
<footer>
    <hr>
    <p>PhosphoQuest Â©2019</p>
</footer>
</html>


